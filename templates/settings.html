<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>ICC Mowing Scheduler - Settings</title>
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      margin: 0; 
      padding: 20px; 
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
    }
    
    .container { max-width: 1000px; margin: 0 auto; }
    
    h1 { 
      color: #2d572c; 
      text-align: center; 
      margin-bottom: 30px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      font-size: 2.5em;
    }
    
    .navbar {
      background: #2d572c;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .navbar a {
      color: white;
      text-decoration: none;
      padding: 10px 15px;
      border-radius: 5px;
      transition: background-color 0.3s;
    }
    
    .navbar a:hover {
      background-color: rgba(255,255,255,0.2);
    }
    
    .card {
      background: white;
      border-radius: 10px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 2px 15px rgba(0,0,0,0.1);
    }
    
    .card h3 {
      color: #2d572c;
      margin-top: 0;
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
    }
    
    label {
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }
    
    input, select, textarea {
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
      transition: border-color 0.3s;
      font-family: inherit;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #2d572c;
      box-shadow: 0 0 0 3px rgba(45, 87, 44, 0.1);
    }
    
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 8px;
    }
    
    .checkbox-group input[type="checkbox"] {
      width: auto;
      transform: scale(1.2);
    }
    
    button {
      background: #2d572c;
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    button:hover {
      background: #1e3d1f;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .btn-secondary {
      background: #6c757d;
    }
    
    .btn-secondary:hover {
      background: #545b62;
    }
    
    .alert {
      padding: 15px;
      margin: 20px 0;
      border-radius: 5px;
      font-weight: 500;
    }
    
    .alert-success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .alert-error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .help-text {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
      font-style: italic;
    }
    
    .equipment-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    
    .equipment-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      background: #f8f9fa;
    }
    
    .equipment-card h5 {
      margin: 0 0 10px 0;
      color: #2d572c;
      font-size: 16px;
    }
    
    .actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #e0e0e0;
    }
    
    .current-value {
      font-size: 14px;
      color: #666;
      background: #f8f9fa;
      padding: 8px 12px;
      border-radius: 4px;
      margin-top: 4px;
    }
    
    @media (max-width: 768px) {
      .navbar {
        flex-direction: column;
        gap: 10px;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .actions {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚öôÔ∏è ICC Mowing Scheduler Settings</h1>
    
    <div class="navbar">
      <div>
        <a href="/dashboard">üìä Dashboard</a>
        <a href="/settings">‚öôÔ∏è Settings</a>
        <a href="/map" target="_blank">üó∫Ô∏è Parks Map</a>
      </div>
      <div>
        <span style="color: white;">Configuration</span>
      </div>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ 'success' if category == 'success' else 'error' }}">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form action="/save_settings" method="post">
      <!-- Business Settings -->
      <div class="card">
        <h3>üè¢ Business Settings</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="business_name">Business Name:</label>
            <input type="text" id="business_name" name="business_name" 
                   value="{{ config.business_settings.business_name }}" required>
            <div class="help-text">Your mowing business name</div>
          </div>
          
          <div class="form-group">
            <label for="service_area">Service Area:</label>
            <input type="text" id="service_area" name="service_area" 
                   value="{{ config.business_settings.service_area }}" required>
            <div class="help-text">Primary service location</div>
          </div>
          
          <div class="form-group">
            <label for="currency">Currency:</label>
            <select id="currency" name="currency">
              <option value="AUD" {{ 'selected' if config.business_settings.currency == 'AUD' }}>AUD</option>
              <option value="USD" {{ 'selected' if config.business_settings.currency == 'USD' }}>USD</option>
              <option value="NZD" {{ 'selected' if config.business_settings.currency == 'NZD' }}>NZD</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Work Schedule Settings -->
      <div class="card">
        <h3>üìÖ Work Schedule</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="start_time">Daily Start Time:</label>
            <input type="time" id="start_time" name="start_time" 
                   value="{{ config.work_schedule.start_time }}" required>
            <div class="current-value">Current: {{ config.work_schedule.start_time }}</div>
          </div>
          
          <div class="form-group">
            <label for="end_time">Daily End Time:</label>
            <input type="time" id="end_time" name="end_time" 
                   value="{{ config.work_schedule.end_time }}" required>
            <div class="current-value">Current: {{ config.work_schedule.end_time }}</div>
          </div>
          
          <div class="form-group">
            <label for="work_days_per_week">Work Days Per Week:</label>
            <input type="number" id="work_days_per_week" name="work_days_per_week" 
                   value="{{ config.work_schedule.work_days_per_week }}" min="1" max="7" required>
            <div class="help-text">Number of working days per week</div>
          </div>
          
          <div class="form-group">
            <label>Include Weekends:</label>
            <div class="checkbox-group">
              <input type="checkbox" id="include_weekends" name="include_weekends" 
                     {{ 'checked' if config.work_schedule.include_weekends }}>
              <label for="include_weekends">Allow weekend work</label>
            </div>
            <div class="help-text">Enable Saturday/Sunday scheduling</div>
          </div>
        </div>
      </div>

      <!-- Team Default Settings -->
      <div class="card">
        <h3>üë• Team Defaults</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="max_daily_hours">Max Daily Hours:</label>
            <input type="number" id="max_daily_hours" name="max_daily_hours" 
                   value="{{ config.team_defaults.max_daily_hours }}" 
                   min="4" max="12" step="0.5" required>
            <div class="help-text">Regular hours before overtime kicks in</div>
          </div>
          
          <div class="form-group">
            <label for="base_hourly_rate">Base Hourly Rate ($):</label>
            <input type="number" id="base_hourly_rate" name="base_hourly_rate" 
                   value="{{ config.team_defaults.base_hourly_rate }}" 
                   min="15" max="100" step="0.50" required>
            <div class="current-value">Current: ${{ config.team_defaults.base_hourly_rate }}/hour</div>
          </div>
          
          <div class="form-group">
            <label>Overtime Allowed:</label>
            <div class="checkbox-group">
              <input type="checkbox" id="overtime_allowed" name="overtime_allowed" 
                     {{ 'checked' if config.team_defaults.overtime_allowed }}>
              <label for="overtime_allowed">Allow overtime work</label>
            </div>
          </div>
          
          <div class="form-group">
            <label for="max_overtime_hours">Max Overtime Hours:</label>
            <input type="number" id="max_overtime_hours" name="max_overtime_hours" 
                   value="{{ config.team_defaults.max_overtime_hours }}" 
                   min="0" max="6" step="0.5">
            <div class="help-text">Maximum overtime hours per day</div>
          </div>
          
          <div class="form-group">
            <label for="default_mowing_rate_sqm_per_hour">Default Mowing Rate (sqm/hour):</label>
            <input type="number" id="default_mowing_rate_sqm_per_hour" name="default_mowing_rate_sqm_per_hour" 
                   value="{{ config.team_defaults.default_mowing_rate_sqm_per_hour }}" 
                   min="500" max="2000" step="50" required>
            <div class="current-value">Current: {{ config.team_defaults.default_mowing_rate_sqm_per_hour }} sqm/hour</div>
          </div>
        </div>
      </div>

      <!-- Equipment Settings -->
      <div class="card">
        <h3>üöú Equipment Rates</h3>
        <div class="equipment-grid">
          {% for equipment, rates in config.equipment_rates.items() %}
          <div class="equipment-card">
            <h5>{{ equipment.replace('_', ' ').title() }}</h5>
            <div class="form-group">
              <label>Rate (sqm/hour):</label>
              <input type="number" name="eq_{{ equipment }}_rate" 
                     value="{{ rates.sqm_per_hour }}" min="300" max="2000" step="50">
            </div>
            <div class="form-group">
              <label>Maintenance Cost ($/hour):</label>
              <input type="number" name="eq_{{ equipment }}_cost" 
                     value="{{ rates.maintenance_cost_per_hour }}" min="1" max="20" step="0.50">
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- Weather Settings -->
      <div class="card">
        <h3>üå§Ô∏è Weather Integration</h3>
        <div class="form-grid">
          <div class="form-group">
            <label>Enable Weather Checking:</label>
            <div class="checkbox-group">
              <input type="checkbox" id="check_weather" name="check_weather" 
                     {{ 'checked' if config.weather_settings.check_weather }}>
              <label for="check_weather">Check weather before scheduling</label>
            </div>
          </div>
          
          <div class="form-group">
            <label for="weather_api_key">Weather API Key:</label>
            <input type="password" id="weather_api_key" name="weather_api_key" 
                   value="{{ config.weather_settings.api_key }}" 
                   placeholder="Enter OpenWeatherMap API key">
            <div class="help-text">Get free API key from openweathermap.org</div>
          </div>
          
          <div class="form-group">
            <label for="rain_threshold">Rain Threshold (%):</label>
            <input type="number" id="rain_threshold" name="rain_threshold" 
                   value="{{ config.weather_settings.rain_threshold }}" 
                   min="10" max="90" step="5">
            <div class="help-text">Cancel jobs if rain probability exceeds this</div>
          </div>
        </div>
      </div>

      <!-- Optimization Settings -->
      <div class="card">
        <h3>üéØ Optimization Parameters</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="max_parks_per_team_per_day">Max Parks Per Team Per Day:</label>
            <input type="number" id="max_parks_per_team_per_day" name="max_parks_per_team_per_day" 
                   value="{{ config.optimization_settings.max_parks_per_team_per_day }}" 
                   min="3" max="15" required>
            <div class="help-text">Limit jobs per team to prevent overwork</div>
          </div>
          
          <div class="form-group">
            <label for="priority_weight">Priority Weight:</label>
            <input type="number" id="priority_weight" name="priority_weight" 
                   value="{{ config.optimization_settings.priority_weight }}" 
                   min="1" max="5" step="0.1">
            <div class="help-text">How much priority affects scheduling (higher = more impact)</div>
          </div>
          
          <div class="form-group">
            <label for="setup_cleanup_time">Setup/Cleanup Time (hours):</label>
            <input type="number" id="setup_cleanup_time" name="setup_cleanup_time" 
                   value="{{ config.optimization_settings.setup_cleanup_time }}" 
                   min="0.1" max="1" step="0.05">
            <div class="help-text">Extra time added to each job for setup</div>
          </div>
        </div>
      </div>

      <!-- Travel Settings -->
      <div class="card">
        <h3>üöó Travel Time Settings</h3>
        <div class="form-grid">
          <div class="form-group">
            <label for="travel_time_same_suburb">Same Suburb Travel (minutes):</label>
            <input type="number" id="travel_time_same_suburb" name="travel_time_same_suburb" 
                   value="{{ config.team_defaults.travel_time_same_suburb }}" 
                   min="5" max="60" step="5">
            <div class="help-text">Average travel time within same suburb</div>
          </div>
          
          <div class="form-group">
            <label for="travel_time_different_suburb">Different Suburb Travel (minutes):</label>
            <input type="number" id="travel_time_different_suburb" name="travel_time_different_suburb" 
                   value="{{ config.team_defaults.travel_time_different_suburb }}" 
                   min="10" max="120" step="5">
            <div class="help-text">Average travel time between different suburbs</div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="actions">
        <button type="button" class="btn-secondary" onclick="resetToDefaults()">
          üîÑ Reset to Defaults
        </button>
        <button type="submit">
          üíæ Save Settings
        </button>
      </div>
    </form>
  </div>

<script>
function resetToDefaults() {
  if (confirm('Are you sure you want to reset all settings to default values? This cannot be undone.')) {
    // Reset form to default values - you could make an API call here
    location.reload();
  }
}

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
  const startTime = document.getElementById('start_time').value;
  const endTime = document.getElementById('end_time').value;
  
  if (startTime && endTime && startTime >= endTime) {
    e.preventDefault();
    alert('End time must be after start time');
    return false;
  }
  
  const maxDaily = parseFloat(document.getElementById('max_daily_hours').value);
  const maxOvertime = parseFloat(document.getElementById('max_overtime_hours').value);
  
  if (maxDaily + maxOvertime > 16) {
    e.preventDefault();
    alert('Total daily hours (regular + overtime) cannot exceed 16 hours');
    return false;
  }
});

// Enable/disable overtime fields based on checkbox
document.getElementById('overtime_allowed').addEventListener('change', function() {
  const overtimeFields = document.getElementById('max_overtime_hours');
  overtimeFields.disabled = !this.checked;
  if (!this.checked) {
    overtimeFields.value = 0;
  }
});

// Weather API key toggle
document.getElementById('check_weather').addEventListener('change', function() {
  const apiKeyField = document.getElementById('weather_api_key');
  const rainThreshold = document.getElementById('rain_threshold');
  
  apiKeyField.disabled = !this.checked;
  rainThreshold.disabled = !this.checked;
  
  if (this.checked && !apiKeyField.value) {
    apiKeyField.focus();
  }
});

// Initialize form state
document.addEventListener('DOMContentLoaded', function() {
  // Trigger change events to set initial state
  document.getElementById('overtime_allowed').dispatchEvent(new Event('change'));
  document.getElementById('check_weather').dispatchEvent(new Event('change'));
});
</script>
</body>
</html>